#!/bin/sh

snipTo() {
	# Selection was cancelled
	[ -z "$2" ] && return

    snipCmd=shotgun
    clipCmd="xclip -selection clipboard -target image/png"

    if [ "$XDG_SESSION_TYPE" = "wayland" ]; then
        snipCmd="grim"
        clipCmd="wl-copy --type image/png"
    fi

    if [ "$1" = "clip" ]; then
		message="The screenshot has been successfully saved to your clipboard."
        output="-"
	else
		output="~/pictures/screenshots/$(date '+%Y-%m-%d_%H.%M.%S').png"
		message="The screenshot has been successfully saved as $output"
        clipCmd="true"
	fi

    shift
    $snipCmd -g "$*" "$(echo "$output" | sed "s|~|$HOME|g")" | $clipCmd

	[ $? -ne 0 ] && return
	notify-send -i accessories-screenshot-symbolic "Snip" "$message" -t 3000
}

case "$1" in
	full|sel)
		sel="$(sel-area "$1")"
		if [ "$2" = "clip" ]; then
			snipTo clip "$sel"
		else
			snipTo file "$sel"
		fi
		;;
	*)
		choice="$(cat << EOF | rofi -dmenu -l 6 -i -p "Screenshot which area?"
a selected area
full screen
a selected area (copy)
full screen (copy)
EOF
		)"
		case "$choice" in
			"a selected area"|"a selected area (copy)")
				sel=$(sel-area)
				if [ "$choice" = "a selected area" ]; then
					snipTo file "$sel"
				else
					snipTo clip "$sel"
				fi
				;;
			"full screen"|"full screen (copy)")
				sel="$(sel-area full)"
				if [ "$choice" = "full screen" ]; then
					snipTo file "$sel"
				else
					snipTo clip "$sel"
				fi
				;;
		esac
		;;
esac
