#!/bin/sh
# This script provides a hassle-free way of taking screenshots.

set -e
screenshotsDir="$(xdg-user-dir PICTURES)/screenshots"

snipTo() {
    if [ "$1" = "clip" ]; then
        message="The screenshot has been successfully saved to your clipboard."
        output="-"
    else
        # shellcheck disable=2088
        output="$screenshotsDir/$(date '+%Y-%m-%d_%H.%M.%S').png"
        message="The screenshot has been successfully saved as \
            $(echo "$output" | sed "s|$HOME|~|")."
    fi

    shotgun -g "$2" "$output" | xclip -sel c -target image/png
    notify-send -i accessories-screenshot-symbolic "Snip" "$message" -t 3000
}

case "$1" in
    full | sel)
        region="$1"
        mode="$2"
        ;;
    *)
        choices="\
ðŸ–± Selection
ðŸ’» Entire Screen
ðŸ–± Selection (Copy)
ðŸ’» Entire Screen (Copy)"

        choice="$(echo "$choices" | dmenu -i -p "Screenshot:")" || exit
        case "$choice" in
            *Selection*) region="sel" ;;
            *) region="full" ;;
        esac

        case "$choice" in
            *Copy*) mode="clip" ;;
            *) mode="file" ;;
        esac
        ;;
esac

sel="$(sel-area "$region")"
snipTo "$mode" "$sel"
