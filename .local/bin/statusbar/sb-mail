#!/bin/sh
# Display unread email count.

TOKENS="token.json"
ICONS=" : "

# Display work email details only during work hours (Mon - Fri; 9 AM - 5 PM).
hour="$(date +%H)"
day_of_the_week="$(date +%u)"
if [ "$day_of_the_week" -lt 6 ] && [ "$hour" -gt 9 ] && [ "$hour" -le 17 ]; then
    TOKENS="$TOKENS work_token.json"
    ICONS="$ICONS  "
fi

counts=""
for token in $TOKENS; do
    token_file="$XDG_CACHE_HOME/qgmail/$token"
    [ ! -r "$token_file" ] && continue

    icon="${ICONS%%:*}"
    ICONS="${ICONS#*:}"
    count="$(
        qgmail --token "$token_file" request users.labels.get me INBOX |
            jq -r '.messagesUnread // empty'
    )"
    counts="$counts${count:+"${counts:+" "}$icon$count"}"
done

[ -z "$counts" ] && exit

. sb-theme
display "$counts"
