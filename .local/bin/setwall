#!/bin/sh
# This script wraps around pywal to configure colorscheme uniformly across all
# my applications.

# Parse CLI flags
QUIET=0
RELOAD=1
LIGHT=0
ALPHA=90
while [ "$#" -gt 0 ]; do
    case $1 in
        -q | --quiet) QUIET=1 ;;
        -n | --noreload) RELOAD=0 ;;
        -t | --theme)
            COLORSCHEME="$2"
            shift
            ;;
        -l | --light) LIGHT=1 ;;
        -a | --alpha)
            ALPHA=$2
            shift
            ;;
        *) wallpaper="$1" ;;
    esac
    shift
done

set --
set -- -e --backend schemer2 -a "$ALPHA" -n
[ "$QUIET" -ne 0 ] && set -- "$@" -q
[ "$LIGHT" -ne 0 ] && set -- "$@" -l

[ ! -f "$wallpaper" ] &&
    wallpaper="$(find ~/pictures/wallpapers/ -type f ! -path '*/.git/*' | shuf -n 1)"

if [ -n "$COLORSCHEME" ]; then
    set -- "$@" --theme "$COLORSCHEME"
else
    set -- "$@" -i "$wallpaper"
fi

wal "$@"
feh --no-fehbg --bg-scale "$wallpaper"
xrdb -DWINTITLE_ALPHA="$(echo "$ALPHA*0.0085" | bc)" \
    -merge ~/.config/X11/Xresources/main

if [ $RELOAD -ne 0 ]; then
    xdotool key Super_L+Shift_L+F5
    pkill dunst
    [ "$TERMINAL" = "st" ] && killall -USR1 st
fi
