#!/bin/sh

cpuProfiles="\
ðŸ’¤ Quiet
ðŸ’» Balanced
ðŸ’¨ Performance"

gpuProfiles="\
ðŸ’» Integrated
ðŸ§® NvidiaNoModeset
ðŸ”® Vfio
ðŸš€ Hybrid"

notify() {
    icon="freon-fan-symbolic"
    [ "$mode" = "GPU" ] && icon="freon-gpu-temperature-symbolic"
    notify-send -i "$icon" "$mode Mode" "Switched to $profile mode." -t 2000
}

mode="CPU"
[ "$1" = "-g" ] && mode="GPU"

if [ "$mode" = "CPU" ]; then
    profiles="$cpuProfiles"
    active="$(asusctl profile -p | cut -d' ' -f4)"
else
    profiles="$gpuProfiles"
    active="$(supergfxctl -g)"

    if [ "$active" = "Hybrid" ]; then
        profiles="$(echo "$profiles" | grep -v Vfio)"
    fi
fi

preselect="$(echo "$profiles" | grep -n -i "$active" | cut -d':' -f1)"
preselect="$((preselect - 1))"
prompt="$mode Profile:"

choice="$(echo "$profiles" | dmenu -i -ps "$preselect" -p "$prompt")"
[ ! "$choice" ] && exit 1

profile="${choice##* }"

if [ "$mode" = "CPU" ]; then
    asusctl profile -P "$profile"
else
    echo "$profile"
    supergfxctl -m "$profile"
fi && notify
