#!/bin/sh

# This script simplifies dropdown windows in Sway.
# Shows/hides a scratchpad of a given name, if it doesn't exist, creates it.
# Usage:
#     ddspawn notes -c $TERMINAL -n %s -e nvim -c VimwikiIndex

instance="dropdown_$1"
while [ "$1" != "-c" ]; do shift; done; shift
cmd="$(printf "$*" $instance)"

windowMeta=$(swaymsg -t get_tree | jq -r -e ".nodes[].nodes[] | .nodes[],.floating_nodes[] | select((.window_properties // empty).instance == \"$instance\")")
if [ $? -eq 0 ]; then
	echo "Window detected."
    if echo $windowMeta | jq -r -e 'select(.visible)'; then
        action="move scratchpad"
    else
        action="scratchpad show"
    fi
    swaymsg "[instance=$instance] $action"
else
	echo "Window not detected... spawning."
	swaymsg "exec $cmd"
fi
