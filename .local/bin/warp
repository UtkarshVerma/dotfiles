#!/bin/sh

serviceStatus=$(systemctl is-active warp-svc)

case "$1" in
    on)
        if [ "$serviceStatus" != "active" ]; then
            systemctl start warp-svc
            sleep .1
        fi
        warp-cli connect 2>&1 >/dev/null
    ;;
    off)
        if [ "$serviceStatus" = "active" ]; then
            warp-cli disconnect 2>&1 >/dev/null
            systemctl stop warp-svc
        fi
    ;;
    *)
        echo "usage:\n\twarp [on|off]"
        exit 1
    ;;
esac

sleep .5
if curl -s https://www.cloudflare.com/cdn-cgi/trace/ | grep -q warp=on; then
    echo "WARP tunnel active"
else
    echo "WARP tunnel inactive"
fi
