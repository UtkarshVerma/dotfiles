 #!/bin/sh

STATUSBAR=${STATUSBAR:-dwmblocks}

notify() {
    icon="mic-unmuted"
    message="The microphone has been unmuted."
    if [ "$1" = "muted" ]; then
        icon="mic-muted"
        message="The microphone has been muted."
    fi

    notify-send -h string:x-canonical-private-synchronous:mic -i $icon Microphone "$message" -t 1500
}

pactl set-source-mute @DEFAULT_SOURCE@ toggle
[ $? -ne 0 ] && exit

pkill -RTMIN+26 $STATUSBAR

if pactl get-source-mute @DEFAULT_SOURCE@ | grep -q yes; then
    notify muted
else
    notify
fi
